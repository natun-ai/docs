"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4953],{5589:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var s=t(4964),i=t(1523);const r={title:"The basics"},a="Install the LabSDK",o={id:"docs/concepts/basics",title:"The basics",description:"In this tutorial, we'll cover the basics of LabSDK to write features and models.",source:"@site/docs/docs/concepts/1-basics.md",sourceDirName:"docs/concepts",slug:"/docs/concepts/basics",permalink:"/docs/concepts/basics",draft:!1,unlisted:!1,editUrl:"https://github.com/raptor-ml/docs/tree/master/docs/docs/concepts/1-basics.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"The basics"},sidebar:"docs",previous:{title:"The production mindset",permalink:"/docs/concepts/mindset"},next:{title:"Data Sources",permalink:"/docs/concepts/datasources"}},l={},c=[];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"In this tutorial, we'll cover the basics of LabSDK to write features and models."}),"\n",(0,s.jsx)(n.h1,{id:"install-the-labsdk",children:"Install the LabSDK"}),"\n",(0,s.jsxs)(n.p,{children:["In order to use the LabSDK, you need to install it. The recommended way is to use\nthe ",(0,s.jsx)(n.a,{href:"https://pip.pypa.io/en/stable/",children:(0,s.jsx)(n.code,{children:"pip"})})," utility:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pip install --upgrade raptor-labsdk\n"})}),"\n",(0,s.jsx)(n.p,{children:"To use the LabSDK, you need to import it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from raptor import *\n"})}),"\n",(0,s.jsx)(n.h1,{id:"hello-world-feature",children:"Hello world feature"}),"\n",(0,s.jsxs)(n.p,{children:["The very first feature we'll build is the ",(0,s.jsx)(n.code,{children:"Hello world"})," feature. It's a simple feature that simply\nreturns the string ",(0,s.jsx)(n.code,{children:'"Hello world"'}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:"showLineNumbers",children:'@feature(keys=[])\n@freshness(max_age=\'1m\', max_stale=\'10h\')\ndef hello_world(_, _) -> str:\n    """this is a hello world feature"""\n    return f"hello world"\n'})}),"\n",(0,s.jsx)(n.p,{children:"Pretty simple right? let's go through what we did here line by line:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We started by declaring the ",(0,s.jsx)(n.a,{href:"/reference/labsdk/decorators",children:(0,s.jsx)(n.code,{children:"@feature"})}),". For now, we're not using any keys, so\nwe're passing an empty list."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"We define the feature's freshness:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["We set the ",(0,s.jsx)(n.code,{children:"max_age"})," to ",(0,s.jsx)(n.code,{children:"1m"})," - that means that feature value that calculated ",(0,s.jsx)(n.code,{children:"1 minute"})," ago, is considered as\nfresh, and doesn't need to be recalculated."]}),"\n",(0,s.jsxs)(n.li,{children:["We set the ",(0,s.jsx)(n.code,{children:"max_stale"})," to ",(0,s.jsx)(n.code,{children:"10h"})," - that means that if we can't have a fresh value, and can't calculate a fresh\nvalue fast enough, we'll use a stale value as long as it's not older than ",(0,s.jsx)(n.code,{children:"10 hours"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{title:"Freshness",type:"tip",children:[(0,s.jsx)(n.p,{children:"The Freshness defines a contract between the feature's author and the production engine.\nBy setting the freshness, you can specify the amount of time that the value is considered fresh, and when it's must\nbe discarded and recalculated."}),(0,s.jsxs)(n.p,{children:["For more information about feature freshness, check out\nthe ",(0,s.jsx)(n.a,{href:"/docs/how-it-works/freshness",children:"Freshness"})," section."]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We defined the feature's logic, and naming our feature ",(0,s.jsx)(n.code,{children:"hello_world"})," and returning ",(0,s.jsx)(n.code,{children:"str"})," primitive type."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"We defined the feature's description. This is a good place to put a description of the feature's logic that can help\nour colleagues to understand it."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We write our business-logic, and simply returned the string ",(0,s.jsx)(n.code,{children:'"hello world"'}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"user-age-feature",children:"User age feature"}),"\n",(0,s.jsxs)(n.p,{children:["The next feature we'll build is the ",(0,s.jsx)(n.code,{children:"user_age"})," feature. It's a simple feature that simply returns the user's age in\nyears.\nIt's using the ",(0,s.jsx)(n.code,{children:"birthdate"})," of the ",(0,s.jsx)(n.code,{children:"user_id"})," to calculate the feature value."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:"showLineNumbers",children:"@feature(keys=['user_id'], data_sources=[User])\n@freshness(max_age='10d', max_stale='30d')\ndef user_age(this_row, ctx: Context) -> int:\n    \"\"\"age of the user in years\"\"\"\n    return (ctx.timestamp - this_row['birthdate']).days // 365\n"})}),"\n",(0,s.jsxs)(n.admonition,{title:"What's the calculation context?",type:"info",children:[(0,s.jsx)(n.p,{children:"The calculation context is a providing information about the calculation process. It contains the following fields:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fqn"})," - the feature's fully qualified name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"keys"})," - a dictionary of the feature's keys."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"timestamp"})," - the timestamp of the calculation."]}),"\n"]}),(0,s.jsxs)(n.p,{children:["For more information about the calculation context, check out\nthe ",(0,s.jsx)(n.a,{href:"/docs/how-it-works/features/context",children:"Context"})," section."]})]}),"\n",(0,s.jsx)(n.h1,{id:"connecting-the-feature-to-data-source",children:"Connecting the feature to data source"}),"\n",(0,s.jsxs)(n.p,{children:["You might have noticed that we're using the ",(0,s.jsx)(n.code,{children:"User"})," data source in the ",(0,s.jsx)(n.code,{children:"user_age"})," feature. The data source is the way we\nconnect the feature to the data that we need to calculate the feature value."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from typing_extensions import TypedDict\n\n\n@data_source(\n    training_data=df,\n    keys=['user_id'],  # Optional\n    production_config=StreamingConfig()  # Optional\n)\nclass User(TypedDict):\n    user_id: str\n    first_name: str\n    last_name: str\n    birthdate: datetime\n"})}),"\n",(0,s.jsx)(n.p,{children:"Data sources are composed of:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Declaring the data source using the ",(0,s.jsx)(n.a,{href:"/reference/labsdk/decorators",children:(0,s.jsx)(n.code,{children:"@data_source"})})," decorator."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In line 4, we're configuring the ",(0,s.jsx)(n.code,{children:"training_data"})," to be a pandas dataframe, that contains the data that we'll use\nto train the model. We can use pandas to import the data from any format that pandas supports, such as CSV,\nParquet, JSON, etc"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In line 5, we're configuring the ",(0,s.jsx)(n.code,{children:"keys"})," of the data source. The keys are the fields that we'll use to identify\nthe data source's rows. In this case, we're using the ",(0,s.jsx)(n.code,{children:"user_id"})," field."]}),"\n",(0,s.jsx)(n.p,{children:"Although the keys are optional, it's highly recommended to use them, because it will help the Raptor engine to\noptimize the feature calculations."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In line 6, we're configuring the ",(0,s.jsx)(n.code,{children:"production_config"})," to be a ",(0,s.jsx)(n.code,{children:"StreamingConfig"}),". This configuration is used to\ncreate a configuration stub for the production environment. This is basically hinting our DevOps team how to\nconfigure and connect our data source in production."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Then, we're defining the data source's schema using the ",(0,s.jsx)(n.code,{children:"TypedDict"})," class. This is a python class that defines the\ndata source's schema. In this case, we're defining the ",(0,s.jsx)(n.code,{children:"User"})," data source to have the following fields:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user_id"})," - a string that contains the user's ID."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"first_name"})," - a string that contains the user's first name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"last_name"})," - a string that contains the user's last name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"birthdate"})," - a datetime that contains the user's birthdate."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Defining the schema is optional, but it's highly recommended to do so, since it can help your IDE to provide you with\nauto-completion and type hints, and can help you make the most of Raptor in the future (i.e. to discover drifts in\nthe data)."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"replaying-the-feature-calculations",children:"Replaying the feature calculations"}),"\n",(0,s.jsx)(n.p,{children:"When we're in development, we need to replay the feature calculations from an historical data we have to get a sense of\nhow the feature will behave in production."}),"\n",(0,s.jsxs)(n.p,{children:["To do that, we can use the ",(0,s.jsx)(n.code,{children:"replay"})," function. It's a function that allows us to replay the feature calculations on the\nDataSource's training data."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:"showLineNumbers",children:"ages_df = user_age.replay()\n\n# Let's see the result\nages_df.head()\n"})}),"\n",(0,s.jsx)(n.h1,{id:"model-training",children:"Model training"}),"\n",(0,s.jsx)(n.p,{children:"Now that we have the feature values, we can train a model."}),"\n",(0,s.jsx)(n.p,{children:"To do that, we'll define a training function, and specify it's input features, label(also a feature)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:"showLineNumbers",children:"@model(\n    keys=['customer_id'],\n    input_features=['total_spend+sum'],\n    input_labels=[amount],\n    model_framework='sklearn',\n    model_server='sagemaker-ack',\n)\n@freshness(max_age='1h', max_stale='100h')\ndef amount_prediction(ctx: TrainingContext):\n    from sklearn.linear_model import LinearRegression\n\n    df = ctx.features_and_labels()\n\n    trainer = LinearRegression()\n    trainer.fit(df[ctx.input_features], df[ctx.input_labels])\n\n    return trainer\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In this example, we're defining a linear regression model that predicts the ",(0,s.jsx)(n.code,{children:"amount"})," feature, using the ",(0,s.jsx)(n.code,{children:"total_spend"}),"\nfeature."]}),"\n",(0,s.jsxs)(n.p,{children:["You can see that we're also specifying the ",(0,s.jsx)(n.code,{children:"model_framework"})," and ",(0,s.jsx)(n.code,{children:"model_server"})," that we're using. This will instruct\nRaptor how to deploy the model in production."]}),"\n",(0,s.jsxs)(n.admonition,{title:"What's the training context?",type:"info",children:[(0,s.jsx)(n.p,{children:"The training context is a providing information about the training process. It contains the following fields:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fqn"})," - the model's fully qualified name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"keys"})," - a dictionary of the model's keys."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"input_features"})," - a list of the model's input features."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"input_labels"})," - a list of the model's input labels."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"features_and_labels()"})," - a function that returns a pandas dataframe that contains the features and labels."]}),"\n"]})]}),"\n",(0,s.jsxs)(n.p,{children:["For more information about the model training, check out the ",(0,s.jsx)(n.a,{href:"/docs/concepts/models",children:"Models"})," section."]}),"\n",(0,s.jsx)(n.h1,{id:"exporting-our-model",children:"Exporting our model"}),"\n",(0,s.jsxs)(n.p,{children:["Once we're done with our model, we can export it, and all of it's dependencies, to the ",(0,s.jsx)(n.code,{children:"out/"})," directory."]}),"\n",(0,s.jsx)(n.p,{children:"This will encapsulate our model, and transform our features and data-sources as production artifacts."}),"\n",(0,s.jsxs)(n.p,{children:["Also, it will create a ",(0,s.jsx)(n.code,{children:"Makefile"})," so it would be easy for DevOps to integrate it in their regular CI/CD pipeline."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:"showLineNumbers",children:"amount_prediction.export()\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1523:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var s=t(6504);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);